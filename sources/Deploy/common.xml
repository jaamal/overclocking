<?xml version="1.0" encoding="UTF-8"?>
<project name="common">
  
  <property name="teamcity.build.checkoutDir" value=""/>
  <condition property="ov.root.dir" value="${teamcity.build.checkoutDir}">
    <and>
      <length string="${teamcity.build.checkoutDir}" trim="true" when="greater" length="0"/>
    </and>
  </condition>
  <property name="ov.root.dir" value="${basedir}"/>
  
  <taskdef resource="net/sf/antcontrib/antlib.xml" classpath="${ov.root.dir}/Deploy/assemblies/ant/ant-contrib.jar"/>
  <taskdef name="ovProjectRefs" classname="tasks.OvProjectRefs" classpath="${ov.root.dir}/Deploy/assemblies/ant/ov.ant.tasks.jar"/>
  <taskdef name="ovProjectJars" classname="tasks.OvProjectJars" classpath="${ov.root.dir}/Deploy/assemblies/ant/ov.ant.tasks.jar"/>

  <property name="compiler.debug" value="on"/>
  <property name="compiler.generate.no.warnings" value="off"/>
  <property name="compiler.args" value=""/>
  <property name="compiler.max.memory" value="128m"/>
  
  <patternset id="ignored.files">
    <exclude name="**/CVS/**"/>
    <exclude name="**/SCCS/**"/>
    <exclude name="**/RCS/**"/>
    <exclude name="**/rcs/**"/>
    <exclude name="**/.DS_Store/**"/>
    <exclude name="**/.svn/**"/>
    <exclude name="**/.pyc/**"/>
    <exclude name="**/.pyo/**"/>
    <exclude name="**/*.pyc/**"/>
    <exclude name="**/*.pyo/**"/>
    <exclude name="**/.git/**"/>
    <exclude name="**/*.hprof/**"/>
    <exclude name="**/_svn/**"/>
    <exclude name="**/.hg/**"/>
    <exclude name="**/*.lib/**"/>
    <exclude name="**/*~/**"/>
    <exclude name="**/__pycache__/**"/>
    <exclude name="**/.bundle/**"/>
    <exclude name="**/*.rbc/**"/>
  </patternset>
  <patternset id="library.patterns">
    <include name="*.war"/>
    <include name="*.ear"/>
    <include name="*.apk"/>
    <include name="*.zip"/>
    <include name="*.swc"/>
    <include name="*.ane"/>
    <include name="*.egg"/>
    <include name="*.jar"/>
  </patternset>
  <patternset id="compiler.resources">
    <exclude name="**/?*.java"/>
    <exclude name="**/?*.form"/>
    <exclude name="**/?*.class"/>
    <exclude name="**/?*.groovy"/>
    <exclude name="**/?*.scala"/>
    <exclude name="**/?*.flex"/>
    <exclude name="**/?*.kt"/>
    <exclude name="**/?*.clj"/>
  </patternset>
  
  <target name="common.copy.libs" description="Copy all project libs to temporary directory">
    <echo message="copy libs of ${proj.name} with ${includeProjectJars}."/>
    
    <mkdir dir="${ov.root.dir}/Deploy/temp/libs"/>
    <ovProjectJars dir="${ov.root.dir}" projName="${proj.name}" to="lib.list" includeProjectJars="${includeProjectJars}"/>
    <for list="${lib.list}" param="lib.path">
      <sequential>
        <copy file="${ov.root.dir}/@{lib.path}" todir="${ov.root.dir}/Deploy/temp/libs"/>
      </sequential>
    </for>
  </target>
  
  <target name="common.cleanup" description="Cleanup temporary directory for libs and bins">
    <delete dir="${ov.root.dir}/Deploy/temp"/>
    <mkdir dir="${ov.root.dir}/Deploy/temp"/>
  </target>
  
</project>