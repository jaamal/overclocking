<?xml version="1.0" encoding="UTF-8"?>
<project name="overclocking" default="run">
  <import file="common.xml"/>
  <import file="compile.xml"/>
  <import file="deploy.xml"/>
  <include file="unit_tests_runner.xml" as="testrunner"/>

  <property name="proj.list" value="Commons,BusinessObjects,Algorithms,Storage,Trees,HttpService"/>
  
  <target name="run">
    <echo message="Deploying project from ${ov.root.dir}."/>
    
    <for list="${proj.list}" param="proj.name">
      <sequential>
        <antcall target="compile.proj">
          <param name="proj.name" value="@{proj.name}"/>
        </antcall>
        
        <antcall target="deploy.proj">
          <param name="proj.name" value="@{proj.name}"/>
        </antcall>
      </sequential>
    </for>
    
    <antcall target="compile.proj">
      <param name="proj.name" value="CompressionService"/>
    </antcall>
    <antcall target="deploy.proj">
      <param name="proj.name" value="CompressionService"/>
      <param name="proj.entry" value="compressionservice.EntryPoint"/>
    </antcall>
    
    <antcall target="compile.proj">
      <param name="proj.name" value="StatisticsService"/>
    </antcall>
    <antcall target="deploy.proj">
      <param name="proj.name" value="StatisticsService"/>
      <param name="proj.entry" value="statisticsservice.EntryPoint"/>
    </antcall>
    
    <echo message="Deploy finished."/>
  </target>

  <target name="run.unit.tests" depends="run">
    <antcall target="testrunner.run.unit.tests">
        <param name="ov.root.dir" value="${ov.root.dir}"/>
    </antcall>
  </target>
</project>